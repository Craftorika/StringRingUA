function StringArtGenerator(t){this.InitCanvas(t),this.InitSelectButton(),this.InitControls(),this.InitEvents()}StringArtGenerator.prototype.SelectImage=function(t){let e=this.fileInput.files;if(1!=e.length)return;let i=new Image;i.onload=()=>this.LoadImage(i),i.src=URL.createObjectURL(e[0]),this.fileInput.value=""},StringArtGenerator.prototype.LoadImage=function(t){this.linesCountValueGenerated.setAttribute("disabled",""),this.linesCountBoxGenerated.setAttribute("disabled",""),this.image=t,this.isLineDrawing=!1,this.Reset(),void 0!==this.formType&&this.formType!=IMAGE_FORM||(this.formType=this.formTypeBox.value,this.InitNails()),this.generateBtn.removeAttribute("disabled")},StringArtGenerator.prototype.UpdateForm=function(){let t=this.formType!=this.formTypeBox.value;this.formType=this.formTypeBox.value,this.InitBbox(),this.DrawLoadedImage(),t&&this.InitNails()},StringArtGenerator.prototype.ToSignString=function(t){return t>0?`+${t}`:t<0?"-"+-t:"0"},StringArtGenerator.prototype.UpdateContrast=function(){let t=+this.contrastBox.value,e=1+t/100;this.contrastValue.innerHTML=this.ToSignString(t),this.contrastTable=[];for(let t=0;t<256;t++)this.contrastTable[t]=this.LimitPixel((t-128)*e+128)},StringArtGenerator.prototype.UpdateBrightness=function(){let t=1+ +this.brightnessBox.value/100;this.brightnessValue.innerHTML=this.ToSignString(+this.brightnessBox.value),this.brightnessTable=[];for(let e=0;e<256;e++)this.brightnessTable[e]=this.LimitPixel(e*t)},StringArtGenerator.prototype.UpdateWeight=function(){let t=+this.linesWeightBox.value;this.linesWeightValue.innerHTML=`${t}%`},StringArtGenerator.prototype.UpdateLineCount=function(){let t=+this.linesCountBox.value;this.linesCountValue.value=`${t}`},StringArtGenerator.prototype.UpdateLineBoxCount=function(){let t=+this.linesCountValue.value;this.linesCountBox.value=`${t}`},StringArtGenerator.prototype.UpdateLineCountGenerated=function(){let t=+this.linesCountBoxGenerated.value;this.linesCountValueGenerated.value=`${t}`,this.stepTo(t)},StringArtGenerator.prototype.UpdateLineBoxCountGenerated=function(){let t=+this.linesCountValueGenerated.value;this.linesCountBoxGenerated.value=`${t}`,this.stepTo(t)},StringArtGenerator.prototype.GetPixels=function(){this.pixelCtx.drawImage(this.canvas,0,0,this.width,this.height);let t=this.pixelCtx.getImageData(0,0,this.width,this.height).data,e=[];for(let i=0;i<t.length;i+=4)e.push(this.GetLightness(t[i],t[i+1],t[i+2]));return e},StringArtGenerator.prototype.GetLineLightness=function(t){let e=0;for(let i of t)e+=this.pixels[i];return e/t.size},StringArtGenerator.prototype.GetNextNail=function(t){let e=t,i=null,n=1/0;for(let s=0;s<this.nails.length;s++){if(s==t)continue;let r=this.LineRasterization(this.nails[s].x,this.nails[s].y,this.nails[t].x,this.nails[t].y),o=this.GetLineLightness(r);o<n&&(n=o,e=s,i=r)}return{nail:e,line:i}},StringArtGenerator.prototype.RemoveLine=function(t,e){for(let i of t)this.pixels[i]=Math.min(255,this.pixels[i]+e*this.dpr)},StringArtGenerator.prototype.TimeToString=function(t){let e=(""+(t=Math.floor(t))%1e3).padStart(3,"0"),i=(""+Math.floor(t/1e3)%60).padStart(2,"0");return`${`${Math.floor(t/6e4)}`.padStart(2,"0")}:${i}.${e}`},StringArtGenerator.prototype.ShowInfo=function(t,e,i){let n=performance.now();this.TimeToString(n-i),this.TimeToString((n-i)/(e-t)*t),((n-i)/(e-t)).toFixed(2)},StringArtGenerator.prototype.GetActions=function(){let t="<b>Основні дії:</b><br>";return"ontouchstart"in window?(t+="<b>Масштабирование</b> - щипок<br>",t+="<b>Перемещение</b> - касание"):(t+="<b>Масштабирование</b> - скроллинг<br>",t+="<b>Перемещение</b> - левая кнопка мыши"),t},StringArtGenerator.prototype.GetLineWeight=function(){return this.LimitPixel(+this.linesWeightBox.value/100*255)},StringArtGenerator.prototype.GetLineColor=function(){return`${this.linesColorBox.value}${this.GetLineWeight().toString(16).padStart(2,"0")}`},StringArtGenerator.prototype.ResetImage=function(){this.imgWidth=this.image.width,this.imgHeight=this.image.height;let t=this.imgWidth/this.imgHeight;this.imgWidth>this.imgHeight?(this.imgWidth=this.width,this.imgHeight=Math.round(this.width/t)):(this.imgHeight=this.height,this.imgWidth=Math.round(this.imgHeight*t)),this.imgX=0,this.imgY=0,this.imgScale=1,this.InitBbox()},StringArtGenerator.prototype.Reset=function(t=!0){this.linesCountValueGenerated.setAttribute("disabled",""),this.linesCountBoxGenerated.setAttribute("disabled",""),this.linesCountBoxGenerated.value=0,this.linesCountValueGenerated.value=0,t&&this.ResetImage(),this.isGenerating=!1,this.isLineDrawing=!1;for(let t of this.controls)t.removeAttribute("disabled");this.DrawLoadedImage()},StringArtGenerator.prototype.StartGenerate=function(){this.isGenerating=!this.isGenerating,this.isLineDrawing||(this.sequence=[],this.DrawLoadedImage(),this.pixels=this.GetPixels(),this.isLineDrawing=!0,this.Clear(this.ctx),this.DrawNails());for(let t of this.controls)t.setAttribute("disabled","");this.generateBtn.value="Пауза",this.linesCountValueGenerated.setAttribute("disabled",""),this.linesCountBoxGenerated.setAttribute("disabled","")},StringArtGenerator.prototype.EndGenerate=function(){this.isGenerating=!1,this.generateBtn.value="Запустити",this.resetBtn.removeAttribute("disabled"),this.selectBtn.removeAttribute("disabled"),this.linesCountBox.removeAttribute("disabled"),this.linesCountValue.removeAttribute("disabled"),this.GoToAsistant.removeAttribute("disabled"),localStorage.setItem("path",JSON.stringify(this.sequence)),localStorage.setItem("stepNumber","");let t=this.sequence.length-1;this.linesCountBoxGenerated.setAttribute("max",t),this.linesCountValueGenerated.setAttribute("max",t),this.linesCountBoxGenerated.value=t,this.linesCountValueGenerated.value=t,this.linesCountBoxGenerated.removeAttribute("disabled"),this.linesCountValueGenerated.removeAttribute("disabled")},StringArtGenerator.prototype.GenerateIteration=function(t,e,i,n,s,r){if(this.sequence.push(t),this.ShowInfo(e,i,r),0==e||!this.isGenerating)return void this.EndGenerate();let o=this.GetNextNail(t);this.RemoveLine(o.line,n),this.DrawLine(this.nails[t],this.nails[o.nail],s),window.requestAnimationFrame((()=>this.GenerateIteration(o.nail,e-1,i,n,s,r)))},StringArtGenerator.prototype.Generate=function(){this.GoToAsistant.setAttribute("disabled",""),localStorage.setItem("selectCountLine",""),this.StartGenerate();let t=+this.linesCountValue.value,e=this.GetLineWeight(),i=this.GetLineColor(),n=performance.now();this.GenerateIteration(0,t,t,e,i,n)},StringArtGenerator.prototype.ToStringArt=function(){return JSON.stringify({nails:this.nails,color:this.GetLineColor(),background:this.backgroundColorBox.value,sequence:this.sequence},null,"    ")},StringArtGenerator.prototype.SetScale=function(t,e,i){let n=(e-this.imgX)/this.imgScale,s=(i-this.imgY)/this.imgScale;this.imgScale=t,this.imgX=e-n*this.imgScale,this.imgY=i-s*this.imgScale},StringArtGenerator.prototype.CalculatePins=function(){for(this.pin_coords=[],center=500,radius=499.5,i=0;i<240;i++)angle=2*Math.PI*i/240,this.pin_coords.push([Math.floor(center+radius*Math.cos(angle)),Math.floor(center+radius*Math.sin(angle))])},StringArtGenerator.prototype.stepTo=function(t){if(pointIndex=t,!(pointIndex<2)&&(pointIndex--,pointIndex--,this.ctx.clearRect(0,0,canvas.width,canvas.width),this.pin_coords&&this.CalculatePins(),this.pin_coords&&this.sequence)){for(i=0;i<pointIndex;i++)this.ctx.beginPath(),this.ctx.moveTo(this.pin_coords[this.sequence[i]][0],this.pin_coords[this.sequence[i]][1]),this.ctx.lineTo(this.pin_coords[this.sequence[i+1]][0],this.pin_coords[this.sequence[i+1]][1]),this.ctx.strokeStyle="black",this.ctx.lineWidth=.35,this.ctx.stroke();lastStepImage=this.ctx.getImageData(0,0,1e3,1e3),pointIndex++,this.ctx.beginPath(),this.ctx.moveTo(this.pin_coords[this.sequence[pointIndex-1]][0],this.pin_coords[this.sequence[pointIndex-1]][1]),this.ctx.lineTo(this.pin_coords[this.sequence[pointIndex]][0],this.pin_coords[this.sequence[pointIndex]][1]),this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.stroke()}};